server {
    # Escuta na porta 81, conforme solicitado
    listen 81;

    # O '_' é um server_name "catch-all", ideal para acesso via IP.
    # Ele responderá a qualquer hostname, incluindo o endereço IP da máquina.
    server_name _;

    # Aumenta o buffer para uploads de arquivos
    client_max_body_size 100M;

    location / {
        # O endereço do proxy para o contêiner da sua aplicação.
        # O nome 'pdf-tools' é o nome do serviço no docker-compose.yml,
        # e o Docker Compose resolve este nome para o IP interno do contêiner.
        proxy_pass http://pdf-tools:3000;

        # Headers importantes para o proxy reverso
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Mantemos o timeout aumentado para operações demoradas
        proxy_connect_timeout 300s;
        proxy_send_timeout    300s;
        proxy_read_timeout    300s;
    }
}